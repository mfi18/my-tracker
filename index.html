<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Expense Tracker Pro</title>
    <style>
        :root {
            --bg-color: #0a0a0c;
            --card-color: #19191e;
            --input-bg: #232328;
            --accent-blue: #0078ff;
            --accent-green: #34ff59;
            --accent-red: #ff3b30;
            --text-dim: #8c8c96;
            --text-main: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden; /* Prevents whole page bounce */
        }

        #app-container {
            width: 100%;
            max-width: 480px;
            height: 100vh;
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        /* --- UI COMPONENTS --- */
        .pill-btn {
            background-color: var(--card-color);
            border-radius: 50px;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 12px;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.1s;
            border: none;
            color: white;
            font-size: 15px;
            width: 100%;
            flex-shrink: 0; /* Prevents buttons from squishing */
        }

        .pill-btn:active { transform: scale(0.96); opacity: 0.8; }

        .btn-green { background-color: var(--accent-green); color: black; }
        .btn-red { background-color: var(--accent-red); color: white; }
        .btn-blue { background-color: var(--accent-blue); color: white; }
        .btn-back { background-color: #3c3c46; width: auto; padding: 8px 20px; margin-bottom: 20px; align-self: flex-start; }

        .header-card {
            background-color: var(--card-color);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 20px;
            margin-top: 20px;
            flex-shrink: 0;
        }

        .wallet-amt { font-size: 32px; font-weight: bold; margin: 5px 0; }
        .month-label { color: var(--text-dim); font-size: 12px; text-transform: uppercase; }

        .input-group { margin-bottom: 20px; text-align: left; }
        .input-label { color: var(--text-dim); font-size: 12px; margin-left: 15px; margin-bottom: 5px; display: block; }
        input {
            width: 100%;
            background-color: var(--input-bg);
            border: 2px solid transparent;
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            font-size: 16px;
            outline: none;
        }
        input:focus { border-color: var(--accent-blue); }

        /* --- VIEW SYSTEM --- */
        .view { 
            display: none; 
            flex-direction: column; 
            height: 100%; 
            overflow: hidden; /* Individual views handle their own scrolling */
        }
        .view.active { display: flex; }

        /* Scrollable Area for History */
        #history-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
            padding-bottom: 50px; /* Space at bottom */
        }

        /* Custom Scrollbar */
        #history-list::-webkit-scrollbar { width: 4px; }
        #history-list::-webkit-scrollbar-track { background: transparent; }
        #history-list::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        .row { display: flex; gap: 10px; flex-shrink: 0; }
        .half { flex: 1; }

        .history-item {
            display: flex;
            flex-direction: column;
            padding: 15px 5px;
            border-bottom: 1px solid #1f1f24;
        }
    </style>
</head>
<body>

<div id="app-container">
    
    <!-- HEADER (Persistent top part) -->
    <div id="header">
        <div class="header-card">
            <div id="display-month" class="month-label">Month: --</div>
            <div id="display-wallet" class="wallet-amt">PKR 0</div>
        </div>
    </div>

    <!-- DASHBOARD VIEW -->
    <div id="view-dashboard" class="view active">
        <div class="row">
            <div class="half"><button class="pill-btn btn-green" onclick="showView('incoming')">INCOMING</button></div>
            <div class="half"><button class="pill-btn btn-red" onclick="showView('outgoing')">OUTGOING</button></div>
        </div>
        <div style="margin-top: 20px;">
            <div id="stat-inc" style="color: var(--accent-green); margin-bottom: 10px; font-weight: 500;">Total Income: 0</div>
            <div id="stat-exp" style="color: var(--accent-red); font-weight: 500;">Total Expense: 0</div>
        </div>

        <div style="margin-top: auto; padding-bottom: 80px;">
            <button class="pill-btn btn-blue" onclick="showView('history')">VIEW HISTORY</button>
        </div>
    </div>

    <!-- INCOMING MENU -->
    <div id="view-incoming" class="view">
        <button class="pill-btn btn-back" onclick="showView('dashboard')">← BACK</button>
        <button class="pill-btn" onclick="prepEntry('Income', 'Pocketmoney', 'Whom received from?')">Pocketmoney</button>
        <button class="pill-btn" onclick="prepEntry('Income', 'Debt Back', 'Who returned?')">Debt Back</button>
        <button class="pill-btn" onclick="prepEntry('Income', 'Borrowed', 'Friend name?')">Borrowed</button>
        <button class="pill-btn" onclick="prepEntry('Income', 'Other', 'Description...')">Other</button>
    </div>

    <!-- OUTGOING MENU -->
    <div id="view-outgoing" class="view">
        <button class="pill-btn btn-back" onclick="showView('dashboard')">← BACK</button>
        <button class="pill-btn" onclick="showView('food')">Food Menu</button>
        <button class="pill-btn" onclick="prepEntry('Expense', 'Cab', 'Where to? (e.g. F-11, Centaurus)')">Cab</button>
        <button class="pill-btn" onclick="prepEntry('Expense', 'Lent Money', 'To whom?')">Lent Money</button>
        <button class="pill-btn" onclick="prepEntry('Expense', 'Rent', 'Month/Hostel Name?')">Rent</button>
        <button class="pill-btn" onclick="prepEntry('Expense', 'Other', 'What bought?')">Other</button>
    </div>

    <!-- FOOD MENU -->
    <div id="view-food" class="view">
        <button class="pill-btn btn-back" onclick="showView('outgoing')">← BACK</button>
        <div id="food-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; overflow-y: auto; padding-bottom: 20px;">
            <!-- Generated by JS -->
        </div>
    </div>

    <!-- INPUT ENTRY -->
    <div id="view-entry" class="view">
        <button class="pill-btn btn-back" onclick="showView('dashboard')">← BACK</button>
        <div class="header-card" style="margin-top: 0; text-align: center;">
            <h2 id="entry-title" style="margin: 0;">Logging: Food</h2>
        </div>
        <div class="input-group">
            <span class="input-label">Amount (PKR)</span>
            <input type="number" id="input-amount" placeholder="0.00" inputmode="decimal">
        </div>
        <div class="input-group">
            <span id="label-desc" class="input-label">Description</span>
            <input type="text" id="input-desc" placeholder="...">
        </div>
        <button class="pill-btn btn-blue" onclick="saveEntry()">CONFIRM ENTRY</button>
    </div>

    <!-- HISTORY VIEW -->
    <div id="view-history" class="view">
        <button class="pill-btn btn-back" onclick="showView('dashboard')">← BACK</button>
        <div id="history-list">
            <!-- Transactions populated here -->
        </div>
    </div>

</div>

<script>
    let transactions = JSON.parse(localStorage.getItem('budget_logs')) || [];
    let activeCat = "", activeSub = "", activeType = "";

    function init() {
        const now = new Date();
        const curMonthYear = `${now.getMonth() + 1}-${now.getFullYear()}`;
        document.getElementById('display-month').innerText = "Month: " + curMonthYear;
        
        const foods = ["Biryani", "Milkshake", "Chaat", "Sandwich", "Pizza", "Burger", "Shawarma", "Drink", "Others"];
        const grid = document.getElementById('food-grid');
        grid.innerHTML = '';
        foods.forEach(f => {
            grid.innerHTML += `<button class="pill-btn" onclick="prepEntry('Expense', '${f}', 'Details (optional)')">${f}</button>`;
        });

        refreshData();
    }

    function refreshData() {
        const now = new Date();
        const curMonthYear = `${now.getMonth() + 1}-${now.getFullYear()}`;
        let wallet = 0, totalIn = 0, totalEx = 0;

        // Sort transactions by date (newest first)
        transactions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        transactions.forEach(t => {
            const val = parseFloat(t.amount);
            if (t.monthYear === curMonthYear) {
                if (t.type === 'Income') totalIn += val;
                else totalEx += val;
            }
            wallet += (t.type === 'Income' ? val : -val);
        });

        document.getElementById('display-wallet').innerText = "PKR " + wallet.toLocaleString();
        document.getElementById('display-wallet').style.color = wallet >= 0 ? "var(--accent-green)" : "var(--accent-red)";
        document.getElementById('stat-inc').innerText = "Total Income: PKR " + totalIn.toLocaleString();
        document.getElementById('stat-exp').innerText = "Total Expense: PKR " + totalEx.toLocaleString();

        const histList = document.getElementById('history-list');
        histList.innerHTML = '';
        
        if (transactions.length === 0) {
            histList.innerHTML = `<div style="text-align:center; color:var(--text-dim); margin-top:20px;">No transactions yet</div>`;
        }

        transactions.forEach(t => {
            histList.innerHTML += `
                <div class="history-item">
                    <div style="display: flex; justify-content: space-between; width: 100%; margin-bottom: 4px;">
                        <span style="color: var(--text-dim); font-size: 11px;">${t.date}</span>
                        <span style="color: ${t.type === 'Income' ? 'var(--accent-green)' : 'var(--accent-red)'}; font-weight: bold;">
                            ${t.type === 'Income' ? '+' : '-'}${parseFloat(t.amount).toLocaleString()}
                        </span>
                    </div>
                    <div style="display: flex; justify-content: space-between; width: 100%; align-items: flex-end;">
                        <span style="font-weight: 500; font-size: 16px;">${t.subCat}</span>
                        <span style="color: var(--text-dim); font-size: 12px; font-style: italic; max-width: 60%; text-align: right;">${t.detail || ''}</span>
                    </div>
                </div>`;
        });
        
        localStorage.setItem('budget_logs', JSON.stringify(transactions));
    }

    function showView(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');
        document.getElementById('header').style.display = (viewId === 'entry') ? 'none' : 'block';
        
        // Auto-scroll history to top when opening
        if(viewId === 'history') {
            document.getElementById('history-list').scrollTop = 0;
        }
    }

    function prepEntry(cat, sub, prompt) {
        activeCat = cat; activeSub = sub; activeType = cat;
        document.getElementById('entry-title').innerText = "Logging: " + sub;
        document.getElementById('label-desc').innerText = prompt;
        document.getElementById('input-amount').value = "";
        document.getElementById('input-desc').value = "";
        showView('entry');
    }

    function saveEntry() {
        const amt = document.getElementById('input-amount').value;
        const desc = document.getElementById('input-desc').value;
        if (!amt || amt <= 0) return;

        const now = new Date();
        const newTrans = {
            timestamp: now.toISOString(),
            date: `${now.getDate()}/${now.getMonth() + 1} ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`,
            category: activeCat,
            subCat: activeSub,
            detail: desc,
            amount: amt,
            type: activeType,
            monthYear: `${now.getMonth() + 1}-${now.getFullYear()}`
        };

        transactions.push(newTrans);
        refreshData();
        showView('dashboard');
    }

    init();
</script>
</body>
</html>

